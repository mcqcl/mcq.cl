<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CANALES</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">

  <link rel="preload" as="image" href="https://cdn.mcq.cl/logo/canales-iso-white.svg" />
  <link rel="preload" as="image" href="https://cdn.mcq.cl/logo/canales-white.svg" />
  <link rel="preload" as="image" href="https://cdn.mcq.cl/assets/img/hecho-en-lima.png" />

  <style>
    :root{
      --bg0:#070A10;
      --bg1:#0A1020;

      --shadow: 0 26px 90px rgba(0,0,0,.70);
      --ease: cubic-bezier(.2,.8,.2,1);

      --paper: rgba(255,255,255,.92);
      --paper2: rgba(255,255,255,.86);
      --ink: rgba(0,0,0,.86);

      --accentA:#4ee1ff;
      --accentB:#8b5cff;
      --accentC:#4effa7;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 520px at 12% 12%, rgba(78,225,255,.10), transparent 62%),
        radial-gradient(900px 560px at 90% 18%, rgba(139,92,255,.10), transparent 66%),
        radial-gradient(900px 560px at 55% 92%, rgba(78,255,167,.08), transparent 68%);
      opacity:.9;
      transform: translateZ(0);
    }

    /* ===== DVD logos background ===== */
    .dvd-layer{
      position:fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
      overflow:hidden;
    }

    .dvd-logo{
      position:absolute;
      will-change: transform;
      transform: translate3d(0,0,0);
      mix-blend-mode: screen;

      /* ‚úÖ blur M√ÅS BAJO para que se vea el fondo */
      opacity: .22;
      filter: blur(14px);
    }

    .dvd-logo.iso{ width: 78px; height: 78px; }
    .dvd-logo.word{ width: 250px; height: auto; }

    @media (max-width:520px){
      .dvd-logo.iso{ width: 60px; height: 60px; }
      .dvd-logo.word{ width: 195px; }
    }

    .vignette{
      position:fixed;
      inset:0;
      z-index:2;
      pointer-events:none;
      background: radial-gradient(1200px 720px at 50% 45%,
        rgba(0,0,0,.00),
        rgba(0,0,0,.30) 55%,
        rgba(0,0,0,.82) 100%);
    }

    .stage{
      position:relative;
      z-index:3;
      min-height:100vh;
      display:grid;
      place-items:center;
      padding: 18px;
    }

    /* ===== Ticket ===== */
    .ticket{
      width:min(720px, 94vw);
      border-radius: 22px;
      position:relative;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .ticket::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(900px 420px at 20% 0%, rgba(0,0,0,.06), transparent 55%),
        radial-gradient(700px 420px at 80% 100%, rgba(0,0,0,.08), transparent 60%),
        linear-gradient(180deg, var(--paper), var(--paper2));
      opacity: 1;
    }

    .ticket::after{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 0% 14%, rgba(7,10,16,1) 0 10px, transparent 11px),
        radial-gradient(circle at 100% 14%, rgba(7,10,16,1) 0 10px, transparent 11px),
        radial-gradient(circle at 0% 86%, rgba(7,10,16,1) 0 10px, transparent 11px),
        radial-gradient(circle at 100% 86%, rgba(7,10,16,1) 0 10px, transparent 11px);
      opacity:.95;
    }

    .ticket-inner{
      position:relative;
      z-index:2;
      padding: 22px 22px 18px;
      color: var(--ink);
    }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 14px;
      margin-bottom: 10px;
    }

    /* Solo ISO en "negro" (invertido del blanco) */
    .iso-black{
      width: 80px;
      height: 80px;
      display:block;
      filter: invert(1) brightness(0);
      opacity:.92;
    }

    .head{
      text-align:right;
      font-family: Space Grotesk, Inter, system-ui, sans-serif;
      font-weight: 800;
      letter-spacing: .7px;
      text-transform: uppercase;
      color: rgba(0,0,0,.72);
    }
    .head .title{
      font-size: 14px;
      letter-spacing: .9px;
      color: rgba(0,0,0,.80);
    }
    .head .meta{
      margin-top: 4px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: rgba(0,0,0,.58);
      line-height: 1.25;
      white-space:nowrap;
    }

    .sep{
      margin: 12px 0 14px;
      height: 1px;
      background: repeating-linear-gradient(
        90deg,
        rgba(0,0,0,.28) 0 10px,
        transparent 10px 18px
      );
      opacity:.70;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px 16px;
      align-items:start;
    }
    @media (max-width: 640px){
      .grid{ grid-template-columns: 1fr; }
      .head{ text-align:left; }
      .head .meta{ white-space:normal; }
    }

    /* ‚úÖ ‚ÄúDOMINIO‚Äù m√°s chico */
    .dom-label{
      font-size: 11px;
      letter-spacing: .9px;
      text-transform: uppercase;
      color: rgba(0,0,0,.55);
      font-weight: 900;
      margin-bottom: 6px;
    }

    /* H1 solo para el dominio */
    .domain-h1{
      margin: 0 0 12px;
      font-family: Space Grotesk, Inter, system-ui, sans-serif;
      font-weight: 900;
      letter-spacing: -0.6px;
      line-height: 1.05;
      font-size: clamp(26px, 3.4vw, 42px);
      color: rgba(0,0,0,.92);
      text-transform: uppercase;
      word-break: break-word;
    }
    .domain-h1 span{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-weight: 900;
      letter-spacing: .2px;
    }

    .line{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      padding: 9px 10px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.14);
      background: rgba(255,255,255,.68);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
      margin-bottom: 8px;
    }
    .line .l{ color: rgba(0,0,0,.70); font-weight: 900; letter-spacing:.6px; text-transform: uppercase; font-size: 11.5px; }
    .line .r{ color: rgba(0,0,0,.88); font-weight: 900; text-transform: uppercase; font-size: 11.5px; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-weight: 900; }

    .desc{
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.5;
      color: rgba(0,0,0,.70);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .2px;
    }

    /* QR box */
    .qrbox{
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.14);
      background: rgba(255,255,255,.66);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
      padding: 12px;
    }

    canvas#qr{
      width: 100%;
      height: auto;
      display:block;
      border-radius: 12px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.10);
    }

    .qrhint{
      margin-top: 10px;
      font-size: 11px;
      color: rgba(0,0,0,.58);
      font-weight: 800;
      letter-spacing: .6px;
      text-transform: uppercase;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .qrhint b{
      width:7px; height:7px; border-radius:999px;
      background: linear-gradient(135deg, var(--accentA), var(--accentB), var(--accentC));
      display:inline-block;
    }

    /* ‚úÖ ‚ÄúBarcode‚Äù con el dominio repetido */
    .domain-barcode{
      margin-top: 14px;
      height: 54px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.14);
      background: rgba(255,255,255,.62);
      position:relative;
      overflow:hidden;
    }

    /* l√≠neas finas para sensaci√≥n de barcode */
    .domain-barcode::before{
      content:"";
      position:absolute; inset:0;
      background: repeating-linear-gradient(
        90deg,
        rgba(0,0,0,.62) 0 1px,
        transparent 1px 3px,
        rgba(0,0,0,.45) 3px 4px,
        transparent 4px 8px
      );
      opacity: .32;
      mix-blend-mode: multiply;
      pointer-events:none;
    }

    .domain-stripe{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      padding: 0 14px;

      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: 2.6px;
      text-transform: uppercase;
      color: rgba(0,0,0,.78);

      white-space: nowrap;
      overflow:hidden;

      /* un poquito ‚Äút√©rmico‚Äù */
      transform: translateZ(0) scaleY(1.08);
      opacity: .86;
      mask-image: linear-gradient(90deg, transparent, #000 10%, #000 90%, transparent);
      -webkit-mask-image: linear-gradient(90deg, transparent, #000 10%, #000 90%, transparent);
    }

    .footnote{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      color: rgba(0,0,0,.55);
      font-size: 11px;
    }

    /* sello m√°s grande + invert */
    .seal{
      height: 68px;
      width:auto;
      display:block;
      filter: invert(1) hue-rotate(180deg) contrast(1.08);
      opacity: .94;
    }
  </style>
</head>

<body>
  <div class="dvd-layer" id="dvdLayer" aria-hidden="true"></div>
  <div class="vignette"></div>

  <div class="stage">
    <section class="ticket" aria-label="Comprobante">
      <div class="ticket-inner">

        <div class="top">
          <img class="iso-black" src="https://cdn.mcq.cl/logo/canales-iso-white.svg" alt="CANALES ISO" />
          <div class="head">
            <div class="title">COMPROBANTE DIGITAL</div>
            <div class="meta" id="ticketCode">ID: ‚Äî</div>
            <div class="meta" id="timeZoneLine">TZ: ‚Äî</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="grid">
          <!-- Resumen -->
          <div>
            <div class="dom-label">DOMINIO</div>
            <h1 class="domain-h1"><span id="dominioH1">‚Äî</span></h1>

            <div class="line">
              <div class="l">EMISI√ìN</div>
              <div class="r mono" id="emision">‚Äî</div>
            </div>

            <div class="line">
              <div class="l">UBICACI√ìN</div>
              <div class="r" id="ubicacion">‚Äî</div>
            </div>

            <div class="desc" id="descripcion">
              HUB CENTRAL DE ENLACES OFICIALES Y PRESENCIA DIGITAL.
            </div>
          </div>

          <!-- QR -->
          <div class="qrbox">
            <canvas id="qr" width="260" height="260" aria-label="QR"></canvas>
            <div class="qrhint"><b></b> ESCANEA PARA VER EL RESUMEN</div>
          </div>
        </div>

        <!-- ‚úÖ ‚Äúbarcode‚Äù con dominio repetido -->
        <div class="domain-barcode" aria-hidden="true">
          <div class="domain-stripe" id="domainStripe">‚Äî</div>
        </div>

        <div class="footnote">
          <span>¬© <span id="yearNow">2026</span> CANALES</span>
          <img class="seal" src="https://cdn.mcq.cl/assets/img/hecho-en-lima.png" alt="Hecho en Lima (invertido)">
        </div>
      </div>
    </section>
  </div>

  <script>
    (function(){
      // ===== Ticket live fields =====
      const elEmision = document.getElementById('emision');
      const elDominioH1 = document.getElementById('dominioH1');
      const elUbicacion = document.getElementById('ubicacion');
      const elTicket = document.getElementById('ticketCode');
      const elTZLine = document.getElementById('timeZoneLine');
      const elYear = document.getElementById('yearNow');
      const elDesc = document.getElementById('descripcion');
      const elDomainStripe = document.getElementById('domainStripe');

      const host = (location && location.hostname) ? location.hostname : "LOCALHOST";
      const HOST = host.toUpperCase();
      elDominioH1.textContent = HOST;

      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "UTC";
      elTZLine.textContent = "TZ: " + tz;

      const tzMap = { "America/Lima": { label: "LIMA, PER√ö", flag: "üáµüá™" } };
      elUbicacion.textContent = (tzMap[tz]) ? `${tzMap[tz].flag} ${tzMap[tz].label}` : `üåê ${tz.toUpperCase()}`;

      function fmtNow(){
        const now = new Date();
        return new Intl.DateTimeFormat('es-PE', {
          weekday:"long", year:"numeric", month:"2-digit", day:"2-digit",
          hour:"2-digit", minute:"2-digit", second:"2-digit", hour12:false
        }).format(now).toUpperCase();
      }

      function ticketId(){
        const now = new Date();
        const pad = (n) => String(n).padStart(2,'0');
        const y = now.getFullYear(), m = pad(now.getMonth()+1), d = pad(now.getDate());
        const hh = pad(now.getHours()), mm = pad(now.getMinutes()), ss = pad(now.getSeconds());
        const dom = HOST.replace(/[^A-Z0-9]/g,'').slice(0,8);
        return `ID: ${y}${m}${d}-${hh}${mm}${ss}-${dom}`;
      }

      // ===== QR-like (sin librer√≠as) =====
      const qrCanvas = document.getElementById('qr');
      const ctx = qrCanvas.getContext('2d');

      function hash32(str){
        let h = 0x811c9dc5;
        for (let i=0; i<str.length; i++){
          h ^= str.charCodeAt(i);
          h = Math.imul(h, 0x01000193);
        }
        return h >>> 0;
      }

      function drawQrLike(payload){
        const size = 29, pad = 2;
        const modules = size + pad*2;

        ctx.clearRect(0,0,qrCanvas.width, qrCanvas.height);
        ctx.fillStyle = "#fff";
        ctx.fillRect(0,0,qrCanvas.width, qrCanvas.height);

        const m = Math.floor(qrCanvas.width / modules);
        const ox = Math.floor((qrCanvas.width - (m*modules))/2);
        const oy = Math.floor((qrCanvas.height - (m*modules))/2);

        function finder(x,y){
          const px = ox + x*m;
          const py = oy + y*m;
          ctx.fillStyle = "#000";
          ctx.fillRect(px, py, 7*m, 7*m);
          ctx.fillStyle = "#fff";
          ctx.fillRect(px+m, py+m, 5*m, 5*m);
          ctx.fillStyle = "#000";
          ctx.fillRect(px+2*m, py+2*m, 3*m, 3*m);
        }

        finder(pad, pad);
        finder(pad + size - 7, pad);
        finder(pad, pad + size - 7);

        ctx.fillStyle = "#000";
        for (let i=0;i<size;i++){
          if (i % 2 === 0){
            ctx.fillRect(ox + (pad + i)*m, oy + (pad + 6)*m, m, m);
            ctx.fillRect(ox + (pad + 6)*m, oy + (pad + i)*m, m, m);
          }
        }

        const seed = hash32(payload);
        function bit(i){
          let x = (seed ^ (i*0x9e3779b9)) >>> 0;
          x ^= x << 13; x >>>= 0;
          x ^= x >> 17; x >>>= 0;
          x ^= x << 5;  x >>>= 0;
          return (x & 1);
        }

        function isReserved(x,y){
          const rx = x - pad, ry = y - pad;
          const inTL = (rx>=0 && ry>=0 && rx<9 && ry<9);
          const inTR = (rx>=size-8 && ry>=0 && rx<size && ry<9);
          const inBL = (rx>=0 && ry>=size-8 && rx<9 && ry<size);
          const inTiming = (ry===6 || rx===6);
          return inTL || inTR || inBL || inTiming;
        }

        let k=0;
        for (let y=0; y<modules; y++){
          for (let x=0; x<modules; x++){
            if (x < pad || y < pad || x >= pad+size || y >= pad+size) continue;
            if (isReserved(x,y)) continue;
            if (bit(k++)){
              ctx.fillStyle = "#000";
              ctx.fillRect(ox + x*m, oy + y*m, m, m);
            }
          }
        }

        ctx.strokeStyle = "rgba(0,0,0,.10)";
        ctx.lineWidth = 1;
        ctx.strokeRect(0.5, 0.5, qrCanvas.width-1, qrCanvas.height-1);
      }

      function buildPayload(){
        return [
          "CANALES | COMPROBANTE",
          "DOMINIO: " + host,
          "EMISION: " + elEmision.textContent,
          "TZ: " + tz,
          "UBICACION: " + elUbicacion.textContent,
          "DESC: " + elDesc.textContent
        ].join(" | ");
      }

      // dominio repetido como ‚Äúbarcode‚Äù
      function buildDomainStripe(){
        const chunk = `${HOST} ¬∑ `;
        let s = "";
        while (s.length < 420) s += chunk; // suficiente para overflow horizontal
        return s.trim();
      }
      elDomainStripe.textContent = buildDomainStripe();

      function tick(){
        elEmision.textContent = fmtNow();
        elTicket.textContent = ticketId();
        elYear.textContent = String(new Date().getFullYear());
        drawQrLike(buildPayload());
      }

      tick();
      setInterval(tick, 1000);

      // ===== DVD background: bouncing blurred white logos =====
      const ISO_SRC  = "https://cdn.mcq.cl/logo/canales-iso-white.svg";
      const WORD_SRC = "https://cdn.mcq.cl/logo/canales-white.svg";
      const layer = document.getElementById('dvdLayer');

      const COUNT = 20;
      const items = [];

      function rand(min, max){ return min + Math.random()*(max-min); }

      function makeEl(type){
        const img = document.createElement('img');
        img.className = `dvd-logo ${type}`;
        img.src = (type === 'iso') ? ISO_SRC : WORD_SRC;
        img.alt = "";
        img.decoding = "async";
        img.loading = "eager";
        layer.appendChild(img);
        return img;
      }

      function init(){
        const vw = window.innerWidth;
        const vh = window.innerHeight;

        for (let i=0;i<COUNT;i++){
          const type = (i % 3 === 0) ? 'word' : 'iso';
          const el = makeEl(type);

          // ‚úÖ blur m√°s bajo + opacidad leve (para que se distinga)
          const scale = (type === 'word') ? rand(0.65, 1.15) : rand(0.75, 1.35);
          const blur  = (type === 'word') ? rand(10, 16) : rand(12, 18);
          const opac  = (type === 'word') ? rand(0.14, 0.22) : rand(0.16, 0.26);

          el.style.filter = `blur(${blur.toFixed(1)}px)`;
          el.style.opacity = opac.toFixed(2);

          const guessW = (type === 'word') ? 250*scale : 78*scale;
          const guessH = (type === 'word') ? 24*scale  : 78*scale;

          let x = rand(0, Math.max(0, vw - guessW));
          let y = rand(0, Math.max(0, vh - guessH));

          let vx = rand(40, 110) * (Math.random() < 0.5 ? -1 : 1);
          let vy = rand(40, 110) * (Math.random() < 0.5 ? -1 : 1);

          items.push({ el, x, y, vx, vy, scale, w: guessW, h: guessH });
        }
      }

      function measure(it){
        const r = it.el.getBoundingClientRect();
        it.w = r.width;
        it.h = r.height;
      }

      let lastFrame = performance.now();

      function animate(now){
        const dt = Math.min(0.033, (now - lastFrame)/1000);
        lastFrame = now;

        const vw = window.innerWidth;
        const vh = window.innerHeight;

        for (const it of items){
          it.x += it.vx * dt;
          it.y += it.vy * dt;

          const maxX = vw - it.w;
          const maxY = vh - it.h;

          let bounced = false;

          if (it.x <= 0){ it.x = 0; it.vx = Math.abs(it.vx); bounced = true; }
          else if (it.x >= maxX){ it.x = maxX; it.vx = -Math.abs(it.vx); bounced = true; }

          if (it.y <= 0){ it.y = 0; it.vy = Math.abs(it.vy); bounced = true; }
          else if (it.y >= maxY){ it.y = maxY; it.vy = -Math.abs(it.vy); bounced = true; }

          if (bounced){
            const j = 0.94 + Math.random()*0.14;
            it.vx *= j;
            it.vy *= j;
          }

          it.el.style.transform = `translate3d(${it.x.toFixed(2)}px, ${it.y.toFixed(2)}px, 0) scale(${it.scale.toFixed(3)})`;
        }

        requestAnimationFrame(animate);
      }

      init();
      window.addEventListener('load', () => items.forEach(measure), { passive:true });
      window.addEventListener('resize', () => items.forEach(measure), { passive:true });
      requestAnimationFrame(animate);
    })();
  </script>
</body>
</html>
